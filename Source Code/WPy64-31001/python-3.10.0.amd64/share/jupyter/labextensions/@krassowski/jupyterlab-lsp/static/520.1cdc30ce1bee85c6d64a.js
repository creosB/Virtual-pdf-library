(self.webpackChunk_krassowski_jupyterlab_lsp=self.webpackChunk_krassowski_jupyterlab_lsp||[]).push([[520,876],{7520:(t,e,o)=>{"use strict";o.r(e),o.d(e,{CodeJumper:()=>h,FileEditorJumper:()=>u,NotebookJumper:()=>c});const i="jumpy_history";class s{constructor(t){this.model_db=t}ensure_history_is_ready(){void 0===this.jump_history&&(this.model_db.has(i)?this.jump_history=this.model_db.get(i):this.jump_history=this.model_db.createList(i))}store(t){this.ensure_history_is_ready(),this.jump_history.push(JSON.stringify(t))}recollect(){if(this.ensure_history_is_ready(),0===this.jump_history.length)return;let t=this.jump_history.get(this.jump_history.length-1);return this.jump_history.undo(),JSON.parse(t)}}var n=o(4835);const r=["ArrowRight","ArrowLeft","ArrowUp","ArrowDown","Home","End","PageUp","PageDown"],l=["Alt","AltGraph","Control","Shift"],d=["F1","F2","F3","F4","F5","F6","F7","F8","F9","F10","F11","F12","ContextMenu"];class h{go_to_position(t,e,o,i,s=0){let n,r={line:i,column:o};n=new(a.get(e))(t,this.document_manager);let l=n.getJumpPosition(r,s);n.jump(l)}_global_jump(t){let e=this.document_manager.openOrReveal(t.contents_path),o=t.is_symlink;e.revealed.then((()=>{this.go_to_position(e,t.contents_path.endsWith(".ipynb")?"notebook":"fileeditor",t.column,t.line,t.editor_index),o&&this.protectFromAccidentalEditing(e)})).catch(console.warn)}protectFromAccidentalEditing(t){let e=t;e.title.label=e.title.label+" (external)";let o=e.content.editor.addKeydownHandler(((t,e)=>-1===r.indexOf(e.key)&&-1===l.indexOf(e.key)&&-1===d.indexOf(e.key)&&(("c"!==e.key||!e.ctrlKey)&&((0,n.showDialog)({title:"Edit external file?",body:"This file is located outside of the root of the JupyterLab start directory. do you really wish to edit it?",buttons:[n.Dialog.cancelButton({label:"Cancel"}),n.Dialog.warnButton({label:"Edit anyway"})]}).then((t=>{t.button.accept&&o.dispose()})).catch(console.warn),!0))))}global_jump_back(){let t=this.history.recollect();t&&this._global_jump(t)}global_jump(t){const e=this.getCurrentPosition();this.history.store(e),this._global_jump(t)}}let a=new Map;class u extends h{constructor(t,e){super(),this.widget=t,this.document_manager=e,this.editor=t.content,this.history=new s(this.editor.model.modelDB)}get path(){return this.widget.context.path}get editors(){return[this.editor.editor]}jump(t){let{token:e}=t,o=this.editor.editor.getPositionAt(e.offset);this.editor.editor.setSelection({start:o,end:o}),this.editor.editor.focus()}getOffset(t){return this.editor.editor.getOffsetAt(t)}getJumpPosition(t){return{token:{offset:this.getOffset(t),value:""},index:0}}getCurrentPosition(){let t=this.editor.editor.getCursorPosition();return{editor_index:null,line:t.line,column:t.column,contents_path:this.editor.context.path,is_symlink:!1}}}a.set("fileeditor",u);class c extends h{constructor(t,e){super(),this.widget=t,this.notebook=t.content,this.history=new s(this.notebook.model.modelDB),this.document_manager=e}get editors(){return this.notebook.widgets.map((t=>t.editor))}jump(t){let{token:e,index:o}=t;setTimeout((()=>{this.notebook.deselectAll(),this.notebook.activeCellIndex=o,function(t,e=!1){let o=t.activeCell;"edit"===t.mode&&o&&(o.editor.hasFocus()||o.editor.focus()),e&&!t.node.contains(document.activeElement)&&t.node.focus()}(this.notebook),this.notebook.mode="edit";let t=this.notebook.activeCell.editor,i=t.getPositionAt(e.offset);t.setSelection({start:i,end:i})}),0)}getOffset(t,e=0){return this.editors[e].getOffsetAt(t)}getCurrentPosition(){let t=this.editors[this.notebook.activeCellIndex].getCursorPosition();return{editor_index:this.notebook.activeCellIndex,line:t.line,column:t.column,contents_path:this.widget.context.path,is_symlink:!1}}getJumpPosition(t,e){return{token:{offset:this.getOffset(t,e),value:""},index:e}}}a.set("notebook",c)}}]);