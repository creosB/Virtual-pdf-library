(self.webpackChunk_bokeh_jupyter_bokeh=self.webpackChunk_bokeh_jupyter_bokeh||[]).push([[809],{5809:(e,t,s)=>{"use strict";s.r(t),s.d(t,{BokehModel:()=>p,BokehView:()=>g,default:()=>k});var n=s(134),i=s(9129);class o{constructor(e){this._context=e}get context(){if(null!=this._context)return this._context;throw new Error("context was already disposed")}get isDisposed(){return null==this._context}dispose(){this.isDisposed||(this._context=null)}}var d=s(6510);const r="application/vnd.bokehjs_load.v0+json",l="application/vnd.bokehjs_exec.v0+json";class c extends d.Widget{constructor(e){super(),this._load_mimetype=r,this._script_element=document.createElement("script")}renderModel(e){const t=e.data[this._load_mimetype];return this._script_element.textContent=t,this.node.appendChild(this._script_element),Promise.resolve()}}class a extends d.Widget{constructor(e,t){super(),this._html_mimetype="text/html",this._js_mimetype="application/javascript",this._exec_mimetype=l,this._script_element=document.createElement("script"),this._manager=t}async renderModel(e){const t=e.metadata[this._exec_mimetype];if(void 0!==t.id){const s=e.data[this._js_mimetype];this._script_element.textContent=s,await function(e,t=1e3,s=100){return new Promise(((n,i)=>{if(e())n();else{const o=setInterval((()=>{e()&&(clearInterval(o),n()),(t-=s)<=0&&(clearInterval(o),i(new Error("timeout")))}),s)}}))}((()=>"undefined"!=typeof Bokeh)),this._document_id=t.id;const{_manager:n}=this,i={registerCommTarget(e,t){var s;const i=null===(s=n.context.sessionContext.session)||void 0===s?void 0:s.kernel;null!=i&&i.registerCommTarget(e,t)}};Bokeh.embed.kernels[this._document_id]=i,n.context.sessionContext.statusChanged.connect(((e,t)=>{"restarting"!=t&&"dead"!==t||delete Bokeh.embed.kernels[this._document_id]}),this)}else if(void 0!==t.server_id){this._server_id=t.server_id;const s=e.data[this._html_mimetype],n=document.createElement("div");n.innerHTML=s;const i=n.children[0].attributes;for(const e in i)this._script_element.setAttribute(i[e].name,i[e].value);this._script_element.textContent=n.textContent}this.node.appendChild(this._script_element)}dispose(){var e;if(!this.isDisposed){if(super.dispose(),this._server_id){const t={code:`import bokeh.io.notebook as ion; ion.destroy_server("${this._server_id}")`},s=null===(e=this._manager.context.sessionContext.session)||void 0===e?void 0:e.kernel;null!=s&&s.requestExecute(t,!0),this._server_id=null}else this._document_id&&(void 0!==Bokeh.embed.kernels&&delete Bokeh.embed.kernels[this._document_id],this._document_id=null);this._manager=null}}}var _=s(48);function m(e){return window.Bokeh.require(e)}const{keys:h,values:u}=Object,v=`^${_.version}`;class p extends n.DOMWidgetModel{defaults(){return Object.assign(Object.assign({},super.defaults()),{_model_name:"BokehModel",_model_module:_.name,_model_module_version:v,_view_name:"BokehView",_view_module:_.name,_view_module_version:v,combine_events:!1,render_bundle:{}})}}p.serializers=Object.assign({},n.DOMWidgetModel.serializers);class g extends n.DOMWidgetView{constructor(e){super(e),this._document=null,this._blocked=!1,this._idle=!0,this._combine=!0,this._msgs=[];const{Receiver:t}=m("protocol/receiver");if(this._receiver=new t,this.model.on("change:render_bundle",(()=>this.render())),null!=window.Jupyter&&null!=window.Jupyter.notebook)window.require("base/js/events").on("kernel_idle.Kernel",(()=>this._process_msg()));else if(null!=this.model.widget_manager.context){const e=this.model.widget_manager.context,t=null!=e.session?e.session.kernel.statusChanged:e.sessionContext.statusChanged;null!=t?t.connect(((e,t)=>{"idle"===t&&this._process_msg()})):this.model.get("combine_events")&&(console.warn("BokehView cannot combine events because Kernel idle status cannot be determined."),this._combine=!1)}else this.model.get("combine_events")&&(console.warn("BokehView cannot combine events because Kernel idle status cannot be determined."),this._combine=!1);this.listenTo(this.model,"msg:custom",((e,t)=>this._consume_patch(e,t)))}_process_msg(){0!=this._msgs.length?this.send(this._msgs.shift()):this._idle=!0}render(){const e=JSON.parse(this.model.get("render_bundle")),{docs_json:t,render_items:s,div:n}=e;this.el.innerHTML=n;const i=this.el.children[0],o=u(t)[0],{Document:d}=m("document"),{add_document_standalone:r}=m("embed/standalone");this._document=d.from_json(o);for(const e of s){const t={};for(const s in e.roots)t[s]=i;r(this._document,i,t)}this._document.on_change((e=>this._change_event(e)))}_combine_events(e){const t=[];for(const s of this._msgs)e.kind!=s.kind?t.push(s):"ModelChanged"==s.kind&&"ModelChanged"==e.kind?s.id==e.id&&s.attr==e.attr||t.push(s):"MessageSent"==s.kind&&"MessageSent"==e.kind&&(null!=s.msg_data.event_values.model&&s.msg_data.event_values.model.id==e.msg_data.event_values.model.id&&s.msg_data.event_name==e.msg_data.event_name||t.push(s));return t.push(e),t}_send(e){!this._idle&&this._combine&&this.model.get("combine_events")?this._msgs=this._combine_events(e):(this._idle=!1,this.send(e))}_change_event(e){if(this._blocked)return;const{ModelChangedEvent:t,MessageSentEvent:s}=m("document/events");if(e instanceof t){const t={event:"jsevent",kind:"ModelChanged",id:e.model.id,attr:e.attr,new:e.new_,old:e.old,hint:null};null!=e.hint&&(null!=e.hint.patches?t.hint={column_source:e.hint.column_source,patches:e.hint.patches}:null!=e.hint.data&&(t.hint={column_source:e.hint.column_source,data:e.hint.data,rollover:e.hint.rollover})),this._send(t)}else if(e instanceof s&&"bokeh_event"==e.msg_type){const t=Object.assign({},e.msg_data),s=Object.assign({},t.event_values);null!=s.model&&(s.model={id:s.model.id}),t.event_values=s;const n={event:"jsevent",kind:"MessageSent",msg_type:e.msg_type,msg_data:t};this._send(n)}}_consume_patch(e,t){if(null!=this._document&&"patch"==e.msg){const{payload:s}=e;this._receiver.consume(null!=s?s:t[0].buffer);const n=this._receiver.message;if(null!=n&&h(n.content).length>0){this._blocked=!0;try{this._document.apply_json_patch(n.content,n.buffers)}finally{this._blocked=!1}}}}}class b{createNew(e,t){const s=new o(t);return e.content.rendermime.addFactory({safe:!1,mimeTypes:[r],createRenderer:e=>new c(e)},0),e.content.rendermime.addFactory({safe:!1,mimeTypes:[l],createRenderer:e=>new a(e,s)},-1),new i.DisposableDelegate((()=>{e.content.rendermime&&e.content.rendermime.removeMimeType(l),s.dispose()}))}}const k={id:_.name,requires:[n.IJupyterWidgetRegistry],activate:(e,t)=>{e.docRegistry.addWidgetExtension("Notebook",new b),t.registerWidget({name:_.name,version:_.version,exports:{BokehModel:p,BokehView:g}})},autoStart:!0}},48:(e,t)=>{Object.assign(t,{name:"@bokeh/jupyter_bokeh",version:"3.0.4"})}}]);