(self.webpackChunk_voila_dashboards_jupyterlab_gridstack=self.webpackChunk_voila_dashboards_jupyterlab_gridstack||[]).push([[24],{24:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>q});var o=i(960),n=i(777),s=i(832),d=i(109),r=i(343),a=i(19),l=i(797),c=i(271),h=i(802);const g=new h.LabIcon({name:"@voila-dashboards/jupyterlab-gridstack:icon-compact",svgstr:'<svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <g class="jp-icon3" stroke="#616161" stroke-width="1">\n        <rect stroke-dasharray="2" width="22" height="22" x="1" y="1" />\n        <rect class="jp-icon3" fill="#616161" width="8" height="8" x="1" y="1" />\n        <path d="M 22 22 L 10 10" />\n        <path class="jp-icon3" fill="#616161" d="M 10 10 L 11 14 L 14 11 L 10 10" stroke-linecap="round"\n            stroke-linejoin="round" />\n    </g>\n</svg>'}),m=new h.LabIcon({name:"@voila-dashboards/jupyterlab-gridstack:icon-dashboard",svgstr:'<svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <g class="jp-icon3" fill="#616161">\n        <rect width="6" height="9" x="2" y="1" />\n        <rect width="12" height="9" x="10" y="1" />\n        <rect width="7" height="9" x="15" y="12" />\n        <rect width="11" height="9" x="2" y="12" />\n    </g>\n</svg>'});class u extends r.ReactWidget{constructor(e){super(),this._panel=e}render(){return c.createElement(r.ToolbarButtonComponent,{icon:g,onClick:()=>{this._panel.compact()},tooltip:"Compact the grid towards the top left corner"})}}class p extends r.ReactWidget{constructor(e){super(),this._panel=e}render(){return c.createElement(r.ToolbarButtonComponent,{icon:h.saveIcon,onClick:()=>{this._panel.save()},tooltip:"Save the layout"})}}class v extends r.ReactWidget{constructor(e){super(),this._panel=e}render(){return c.createElement(r.ToolbarButtonComponent,{icon:h.editIcon,onClick:()=>{this._panel.info()},tooltip:"Edit grid parameters"})}}class _ extends r.ReactWidget{constructor(e){super(),this._panel=e}render(){return c.createElement(r.ToolbarButtonComponent,{icon:h.undoIcon,onClick:()=>{this._panel.revert()},tooltip:"Reload Notebook from Disk"})}}var f=i(629);class y extends r.ReactWidget{constructor(e){super(),this._path=e}render(){return c.createElement(r.ToolbarButtonComponent,{icon:h.launcherIcon,onClick:()=>{const e=f.PageConfig.getBaseUrl(),t=window.open(`${e}voila/render/${this._path+"?voila-template=gridstack"}`,"_blank");null==t||t.focus()},tooltip:"Open with VoilÃ  Gridstack in a New Browser Tab"})}}class C extends a.DocumentWidget{constructor(e,t){super({context:e,content:t}),this.title.label=e.localPath,this.title.closable=!0,this.title.iconClass="jp-MaterialIcon jp-VoilaIcon",this.toolbar.addItem("save",new p(this.content)),this.toolbar.addItem("revert",new _(this.content)),this.toolbar.addItem("edit",new v(this.content)),this.toolbar.addItem("compact",new u(this.content)),this.toolbar.addItem("voila",new y(this.context.path))}}const w=new l.Token("@voila-dashboards/jupyterlab-gridstack:IVoilaGridstackTracker");var b=i(510),k=i(168),x=i(724),I=i(850),E=i(211),W=i(667);i(43);class N extends b.Layout{constructor(e){super(),this._gridItems=[],this._gridItemChanged=new k.Signal(this),this._margin=e.cellMargin,this._cellHeight=e.defaultCellHeight,this._columns=e.maxColumns,this._helperMessage=document.createElement("div"),this._helperMessage.appendChild(document.createElement("p")).textContent="Drag and drop cells here to start building the dashboard.",this._helperMessage.className="jp-grid-helper",this._gridHost=document.createElement("div"),this._gridHost.className="grid-stack",this._grid=W.GridStack.init({float:!0,column:this._columns,margin:this._margin,cellHeight:this._cellHeight,styleInHead:!0,disableOneColumnMode:!0,draggable:{handle:".grid-item-toolbar"},resizable:{autoHide:!0,handles:"e, se, s, sw, w"},alwaysShowResizeHandle:/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)},this._gridHost),this._updateBackgroundSize(),this._grid.on("change",((e,t)=>{this._onChange(e,t)})),this._grid.on("removed",((e,t)=>{t.length<=1&&this._onRemoved(e,t)})),this._grid.on("resizestop",((e,t)=>{window.dispatchEvent(new Event("resize"))}))}get gridItemChanged(){return this._gridItemChanged}dispose(){this._grid.destroy(),super.dispose()}init(){super.init(),this.parent.node.appendChild(this._gridHost),0===this._gridItems.length&&this._gridHost.insertAdjacentElement("beforebegin",this._helperMessage),window.dispatchEvent(new Event("resize"))}onUpdateRequest(e){var t;const i=null===(t=this._grid)||void 0===t?void 0:t.getGridItems();null==i||i.forEach((e=>{this._grid.removeWidget(e,!0,!1),this._grid.addWidget(e)}))}onResize(e){this._grid.onParentResize()}onFitRequest(e){this._grid.onParentResize()}iter(){return new I.ArrayIterator(this._gridItems)}removeWidget(e){}get margin(){return this._margin}set margin(e){this._margin!==e&&(this._margin=e,this._grid.margin(this._margin),this.parent.update())}get cellHeight(){var e;return null!==(e=this._grid.getCellHeight(!0))&&void 0!==e?e:this._cellHeight}set cellHeight(e){this._cellHeight!==e&&(this._cellHeight=e,this._grid.cellHeight(this._cellHeight),this._updateBackgroundSize(),this.parent.update())}get columns(){return this._columns}set columns(e){this._columns!==e&&(this._columns=e,this._grid.column(e),this._updateBackgroundSize(),this.parent.update())}get grid(){return this._grid}get gridWidgets(){return this._gridItems}get gridItems(){var e;return null!==(e=this._grid.getGridItems())&&void 0!==e?e:[]}addGridItem(e,t,i){const o={id:e,x:i.col,y:i.row,width:i.width,height:i.height,autoPosition:!1};null!==i.row&&null!==i.col||(o.autoPosition=!0),this._gridItems.push(t),1===this._gridItems.length&&this.parent.node.removeChild(this._helperMessage),E.MessageLoop.sendMessage(t,b.Widget.Msg.BeforeAttach),this._grid.addWidget(t.node,o),E.MessageLoop.sendMessage(t,b.Widget.Msg.AfterAttach),this.updateGridItem(e,i)}updateGridItem(e,t){const i=this._grid.getGridItems(),o=null==i?void 0:i.find((t=>{var i;return(null===(i=t.gridstackNode)||void 0===i?void 0:i.id)===e}));this._grid.update(o,{x:t.col,y:t.row,w:t.width,h:t.height})}removeGridItem(e){const t=this._grid.getGridItems(),i=null==t?void 0:t.find((t=>{var i;return(null===(i=t.gridstackNode)||void 0===i?void 0:i.id)===e}));i&&(this._gridItems=this._gridItems.filter((t=>t.cellId!==e)),this._grid.removeWidget(i,!0,!1)),0===this._gridItems.length&&this._gridHost.insertAdjacentElement("beforebegin",this._helperMessage)}_onChange(e,t){this._gridItemChanged.emit(null!=t?t:[])}_onRemoved(e,t){t.forEach((e=>{}))}_updateBackgroundSize(){this._gridHost.style.backgroundSize=`100px ${this.cellHeight}px, calc(100% / ${this.columns} + 0px) 100px, 20px 20px, 20px 20px`}}class M extends r.ReactWidget{constructor(e){super(),this._info=e}get info(){return this._info}render(){return c.createElement("form",{className:"jp-Input-Dialog jp-Dialog-body"},c.createElement("div",{className:"row"},c.createElement("label",{className:"col-25"},"Name:"),c.createElement("input",{type:"text",name:"name",className:"jp-mod-styled col-75",value:this._info.name,onChange:e=>{this._info.name=e.target.value,this.update()}})),c.createElement("div",{className:"row"},c.createElement("label",{className:"col-25"},"Type:"),c.createElement("input",{type:"text",name:"name",className:"jp-mod-styled col-75",value:this._info.type,disabled:!0})),c.createElement("div",{className:"row"},c.createElement("label",{className:"col-25"},"Cell Margin:"),c.createElement("input",{type:"number",name:"margin",className:"jp-mod-styled col-75",value:this._info.cellMargin,onChange:e=>{this._info.cellMargin=parseInt(e.target.value,10),this.update()}})),c.createElement("div",{className:"row"},c.createElement("label",{className:"col-25"},"Cell Height:")," ",c.createElement("input",{type:"number",name:"height",className:"jp-mod-styled col-75",value:this._info.defaultCellHeight,onChange:e=>{const t=parseInt(e.target.value,10);this._info.defaultCellHeight=t<40?40:t,this.update()}})),c.createElement("div",{className:"row"},c.createElement("label",{className:"col-25"},"Number of columns:")," ",c.createElement("input",{type:"number",name:"columns",className:"jp-mod-styled col-75",value:this._info.maxColumns,onChange:e=>{let t=parseInt(e.target.value,10);t=t>12?12:t,t=t<1?1:t,this._info.maxColumns=t,this.update()},disabled:!0})))}}class S extends b.Widget{constructor(e){super(),this._shadowWidget=null,this.removeClass("lm-Widget"),this.removeClass("p-Widget"),this.addClass("grid-editor"),this._model=e,this.layout=new N(this._model.info),this.layout.gridItemChanged.connect(this._onGridItemChange,this),this._model.ready.connect((()=>{this._initGridItems(),this._model.cellRemoved.connect(this._removeCell,this),this._model.contentChanged.connect(this._updateGridItems,this)}))}compact(){this.layout.grid.compact()}dispose(){this.isDisposed||(this._shadowWidget&&this._resetShadowWidget(),k.Signal.clearData(this),super.dispose())}onAfterAttach(e){super.onAfterAttach(e),this.node.addEventListener("lm-dragenter",this,!0),this.node.addEventListener("lm-dragleave",this,!0),this.node.addEventListener("lm-dragover",this,!0),this.node.addEventListener("lm-drop",this,!0),this.node.addEventListener("lm-dragend",this,!0)}onBeforeDetach(e){super.onBeforeDetach(e),this.node.removeEventListener("lm-dragenter",this,!0),this.node.removeEventListener("lm-dragleave",this,!0),this.node.removeEventListener("lm-dragover",this,!0),this.node.removeEventListener("lm-drop",this,!0),this.node.removeEventListener("lm-dragend",this,!0)}handleEvent(e){if(e.type&&"copy"===e.proposedAction)switch(e.type){case"lm-dragenter":this._evtDragEnter(e);break;case"lm-dragleave":this._evtDragLeave(e);break;case"lm-dragover":this._evtDragOver(e);break;case"lm-drop":this._evtDrop(e)}}get gridWidgets(){return this.layout.gridWidgets}infoEditor(){const e=new M(this._model.info);(0,r.showDialog)({title:"Edit grid parameters",body:e}).then((t=>{t.button.accept&&(this._model.info=e.info,this.layout&&(this.layout.margin=e.info.cellMargin,this.layout.cellHeight=e.info.defaultCellHeight,this.layout.columns=e.info.maxColumns))}))}_initGridItems(){const e=this._model.cells;for(let t=0;t<(null==e?void 0:e.length);t++){const i=e.get(t);this._model.execute(i);const o=this._model.getCellInfo(i.id);if(o&&!o.hidden&&0!==i.value.text.length){const e=this._model.createCell(i);this.layout.addGridItem(i.id,e,o)}}}_removeCell(e,t){this._model.hideCell(t),this.layout.removeGridItem(t)}_updateGridItems(){var e;this.layout.gridItems.forEach((e=>{var t,i;let o=!1;for(let n=0;n<(null===(t=this._model.cells)||void 0===t?void 0:t.length);n++)if((null===(i=e.gridstackNode)||void 0===i?void 0:i.id)===this._model.cells.get(n).id){o=!0;break}!o&&e.gridstackNode&&(this._model.hideCell(e.gridstackNode.id),this.layout.removeGridItem(e.gridstackNode.id))}));for(let t=0;t<(null===(e=this._model.cells)||void 0===e?void 0:e.length);t++){const e=this._model.cells.get(t),i=this._model.getCellInfo(e.id),o=this.layout.gridItems,n=null==o?void 0:o.find((t=>{var i;return(null===(i=t.gridstackNode)||void 0===i?void 0:i.id)===e.id}));if(!n&&i&&!i.hidden&&0!==e.value.text.length){if("code"===e.type&&e.executionCount&&0!==e.outputs.length){const t=e.outputs;let o=!1;for(let e=0;e<t.length;e++)if("error"===t.get(e).type){o=!0;break}if(o)continue;const n=this._model.createCell(e);this.layout.addGridItem(e.id,n,i);continue}if("code"!==e.type){const t=this._model.createCell(e);this.layout.addGridItem(e.id,t,i);continue}}n&&i&&!i.hidden&&0!==e.value.text.length?this.layout.updateGridItem(e.id,i):(n&&i&&!i.hidden&&0===e.value.text.length||n&&(null==i?void 0:i.hidden))&&(this._model.hideCell(e.id),this.layout.removeGridItem(e.id))}}_onGridItemChange(e,t){null===this._shadowWidget&&t.forEach((e=>{var t,i,o,n;this._model.setCellInfo(e.id,{hidden:!1,col:null!==(t=e.x)&&void 0!==t?t:0,row:null!==(i=e.y)&&void 0!==i?i:0,width:null!==(o=e.w)&&void 0!==o?o:2,height:null!==(n=e.h)&&void 0!==n?n:2})}))}_evtDragEnter(e){var t,i;const o=this._isDroppable(e);if(o.droppable){e.preventDefault(),e.stopPropagation();const o=e.source.parent.content.activeCell,n=this.layout.gridItems.find((e=>{var t;return(null===(t=e.gridstackNode)||void 0===t?void 0:t.id)===o.model.id})),s=Math.floor(e.offsetY/this.layout.cellHeight),d=Math.floor(this.layout.columns*e.offsetX/this.node.offsetWidth),r=this.layout.columns-d;let a=1;a="code"===o.model.type?Math.ceil((o.node.scrollHeight-o.inputArea.node.scrollHeight)/this.layout.cellHeight):Math.ceil(o.node.scrollHeight/this.layout.cellHeight),this._resetShadowWidget(),this.layout.grid.el.style.pointerEvents="none",n?(this._shadowWidget=n,this.layout.grid.update(n,{x:d,y:s,w:Math.min(r,null!==(i=null===(t=n.gridstackNode)||void 0===t?void 0:t.w)&&void 0!==i?i:this.layout.columns),h:a})):this._shadowWidget=this.layout.grid.addWidget('<div class="grid-stack-item grid-stack-placeholder"><div class="grid-stack-item-content placeholder-content"></div></div>',{x:d,y:s,w:r,h:a})}else o.reason&&this._setErrorMessage(o.reason)}_evtDragLeave(e){this.removeClass("pr-DropTarget"),this._isPointerOnWidget(e)||this._resetShadowWidget(),e.preventDefault(),e.stopPropagation()}_evtDragOver(e){var t,i;if(this.addClass("pr-DropTarget"),e.dropAction="copy",this._shadowWidget){const o=Math.floor(this.layout.columns*e.offsetX/this.node.offsetWidth);let n=this.layout.columns-o;this._shadowWidget.classList.contains("grid-stack-placeholder")||(n=Math.min(n,null!==(i=null===(t=this._shadowWidget.gridstackNode)||void 0===t?void 0:t.w)&&void 0!==i?i:this.layout.columns)),this.layout.grid.update(this._shadowWidget,{x:o,y:Math.floor(e.offsetY/this.layout.cellHeight),w:n})}e.preventDefault(),e.stopPropagation()}_evtDrop(e){if(e.preventDefault(),e.stopPropagation(),this._resetShadowWidget(),"copy"===e.proposedAction){if(e.source.activeCell instanceof x.Cell){const t=e.source.parent.content.activeCell;if(!t)return;const i=Math.floor(e.offsetY/this.layout.cellHeight),o=Math.floor(this.layout.columns*e.offsetX/this.node.offsetWidth),n=this.layout.columns-o;let s=1;s="code"===t.model.type?Math.ceil((t.node.scrollHeight-t.inputArea.node.scrollHeight)/this.layout.cellHeight):Math.ceil(t.node.scrollHeight/this.layout.cellHeight);const d=this.layout.gridItems,a=null==d?void 0:d.find((e=>{var i;return(null===(i=e.gridstackNode)||void 0===i?void 0:i.id)===(null==t?void 0:t.model.id)})),l=this._model.getCellInfo(t.model.id);if(!a&&(null==l?void 0:l.hidden))if("code"===t.model.type&&t.model.executionCount&&0!==t.model.outputs.length){const e=t.model.outputs;for(let t=0;t<e.length;t++)if("error"===e.get(t).type)return void(0,r.showErrorMessage)("Cell error","It is not possible to add cells with execution errors.");l.hidden=!1,l.col=o,l.row=i,l.width=n,l.height=s,this._model.setCellInfo(t.model.id,l);const d=this._model.createCell(t.model);this.layout.addGridItem(t.model.id,d,l)}else if("code"!==t.model.type&&0!==t.model.value.text.length){l.hidden=!1,l.col=o,l.row=i,l.width=n,l.height=s,this._model.setCellInfo(t.model.id,l);const e=this._model.createCell(t.model);this.layout.addGridItem(t.model.id,e,l)}else(0,r.showErrorMessage)("Empty cell","It is not possible to add empty cells.");else a&&l?(l.hidden=!1,l.col=o,l.row=i,l.width=Math.min(n,l.width),this._model.setCellInfo(t.model.id,l),this.layout.updateGridItem(t.model.id,l)):l||(0,r.showErrorMessage)("Wrong notebook","It is not possible to add cells from another notebook.")}this.removeClass("pr-DropTarget")}}_isDroppable(e){if("copy"!==e.proposedAction)return{droppable:!1};if(e.source.activeCell instanceof x.Cell){const t=e.source.parent.content.activeCell;if(!t)return{droppable:!1};const i=this.layout.gridItems,o=null==i?void 0:i.find((e=>{var i;return(null===(i=e.gridstackNode)||void 0===i?void 0:i.id)===(null==t?void 0:t.model.id)})),n=this._model.getCellInfo(t.model.id);if(!o&&(null==n?void 0:n.hidden)){if("code"===t.model.type&&t.model.executionCount&&0!==t.model.outputs.length){const e=t.model.outputs;for(let t=0;t<e.length;t++)if("error"===e.get(t).type)return{droppable:!1,reason:"GridStack Error: cells with execution errors."};return{droppable:!0}}return"code"!==t.model.type&&0!==t.model.value.text.length?{droppable:!0}:{droppable:!1,reason:"GridStack Error: empty cells."}}if(o&&n)return{droppable:!0};if(!n)return{droppable:!1,reason:"GridStack Error: cells from another notebook."}}return{droppable:!1}}_isPointerOnWidget(e){const t=this.node.getBoundingClientRect();return e.clientX>=t.left&&e.clientX<=t.right&&e.clientY>=t.top&&e.clientY<=t.bottom}_resetShadowWidget(){var e,t;if(this._shadowWidget){if(this._shadowWidget.classList.contains("grid-stack-placeholder"))this.layout.grid.removeWidget(this._shadowWidget,!0,!1);else{const i=this._model.getCellInfo(null===(e=this._shadowWidget.gridstackNode)||void 0===e?void 0:e.id);i&&this.layout.updateGridItem(null===(t=this._shadowWidget.gridstackNode)||void 0===t?void 0:t.id,i)}this._shadowWidget=null,this.layout.grid.el.style.pointerEvents="auto"}}_setErrorMessage(e){const t=document.body.querySelector(".lm-mod-drag-image");if(t){let i=t.querySelector(".grid-stack-error");i||(i=t.appendChild(document.createElement("div")),i.className="grid-stack-error"),i.innerHTML=`<p>${e}</p>`}}}var j=i(340);const H=new h.LabIcon({name:"jupyterlab-gridstack:delete",svgstr:'<svg width="16" height="16" version="1.1" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg">\n <g class="jp-icon3" transform="matrix(.03125 0 0 .03125 1.7764 0)" fill="#616161">\n  <path d="m156.37 30.906h85.57v14.398h30.902v-16.414c0.00391-15.93-12.949-28.891-28.871-28.891h-89.633c-15.922 0-28.875 12.961-28.875 28.891v16.414h30.906z"/>\n  <path d="m344.21 167.75h-290.11c-7.9492 0-14.207 6.7812-13.566 14.707l24.254 299.91c1.3516 16.742 15.316 29.637 32.094 29.637h204.54c16.777 0 30.742-12.895 32.094-29.641l24.254-299.9c0.64453-7.9258-5.6133-14.707-13.562-14.707zm-219.86 312.26c-0.32422 0.0195-0.64844 0.0312-0.96875 0.0312-8.1016 0-14.902-6.3086-15.406-14.504l-15.199-246.21c-0.52344-8.5195 5.957-15.852 14.473-16.375 8.4883-0.51562 15.852 5.9492 16.375 14.473l15.195 246.21c0.52734 8.5195-5.9531 15.848-14.469 16.375zm90.434-15.422c0 8.5312-6.918 15.449-15.453 15.449-8.5352 0-15.453-6.918-15.453-15.449v-246.21c0-8.5352 6.918-15.453 15.453-15.453 8.5312 0 15.453 6.918 15.453 15.453zm90.758-245.3-14.512 246.21c-0.48047 8.2109-7.293 14.543-15.41 14.543-0.30469 0-0.61328-8e-3 -0.92188-0.0234-8.5195-0.5039-15.02-7.8164-14.516-16.336l14.508-246.21c0.5-8.5195 7.7891-15.02 16.332-14.516 8.5195 0.5 15.02 7.8164 14.52 16.336z"/>\n  <path d="m397.65 120.06-10.148-30.422c-2.6758-8.0195-10.184-13.43-18.641-13.43h-339.41c-8.4531 0-15.965 5.4102-18.637 13.43l-10.148 30.422c-1.957 5.8672 0.58984 11.852 5.3438 14.836 1.9375 1.2148 4.2305 1.9453 6.75 1.9453h372.8c2.5195 0 4.8164-0.73047 6.75-1.9492 4.7539-2.9844 7.3008-8.9688 5.3438-14.832z"/>\n </g>\n</svg>\n'});class G extends b.Widget{constructor(e,t,i){super(),this._cellId="",this.removeClass("lm-Widget"),this.removeClass("p-Widget"),this.addClass("grid-stack-item");const o=document.createElement("div");o.className="grid-stack-item-content";const n=document.createElement("div");n.className="grid-item-toolbar";const s=document.createElement("div");s.className="grid-item-widget",this._cell=s,this._item=t,this._cellId=e,n.appendChild(i),o.appendChild(n),o.appendChild(s),this.node.appendChild(o)}get cellId(){return this._cellId}onAfterAttach(){b.Widget.attach(this._item,this._cell)}}const D="grid_default";class R{constructor(e){this._context=e.context,this.rendermime=e.rendermime,this.contentFactory=e.contentFactory,this.mimeTypeService=e.mimeTypeService,this._editorConfig=e.editorConfig,this._notebookConfig=e.notebookConfig,this._ready=new k.Signal(this),this._cellRemoved=new k.Signal(this),this._stateChanged=new k.Signal(this),this._contentChanged=new k.Signal(this),this._info={name:"grid",type:"grid",maxColumns:12,cellMargin:2,defaultCellHeight:60},this._context.sessionContext.ready.then((()=>{this._checkMetadata(),this._checkCellsMetadata(),this._context.save().then((e=>{this._ready.emit(null)}))})),this._context.model.contentChanged.connect(this._updateCells,this)}get ready(){return this._ready}get cellRemoved(){return this._cellRemoved}get stateChanged(){return this._stateChanged}get contentChanged(){return this._contentChanged}get editorConfig(){return this._editorConfig}set editorConfig(e){this._editorConfig=e}get notebookConfig(){return this._notebookConfig}set notebookConfig(e){this._notebookConfig=e}get info(){return this._info}set info(e){this._info=e;const t=this._context.model.metadata.get("extensions");t.jupyter_dashboards.views[D]=this._info,this._context.model.metadata.set("extensions",t),this._context.model.dirty=!0}get cells(){return this._context.model.cells}get deletedCells(){return this._context.model.deletedCells}getCellInfo(e){var t;for(let i=0;i<(null===(t=this._context.model.cells)||void 0===t?void 0:t.length);i++){const t=this._context.model.cells.get(i);if(t.id===e)return t.metadata.get("extensions").jupyter_dashboards.views[D]}}setCellInfo(e,t){var i;for(let o=0;o<(null===(i=this._context.model.cells)||void 0===i?void 0:i.length);o++){const i=this._context.model.cells.get(o);if(i.id===e){const e=i.metadata.get("extensions");e.jupyter_dashboards.views[D]=t,i.metadata.set("extensions",e),this._context.model.dirty=!0}}}hideCell(e){var t;for(let i=0;i<(null===(t=this._context.model.cells)||void 0===t?void 0:t.length);i++){const t=this._context.model.cells.get(i);if(t.id===e){const e=t.metadata.get("extensions");e.jupyter_dashboards.views[D].hidden=!0,t.metadata.set("extensions",e),this._context.model.dirty=!0}}}createCell(e){let t;switch(e.type){case"code":{const i=new x.CodeCell({model:e,rendermime:this.rendermime,contentFactory:this.contentFactory,editorConfig:this._editorConfig.code,updateEditorOnShow:!0});t=new j.SimplifiedOutputArea({model:i.outputArea.model,rendermime:i.outputArea.rendermime,contentFactory:i.outputArea.contentFactory});break}case"markdown":{const i=new x.MarkdownCell({model:e,rendermime:this.rendermime,contentFactory:this.contentFactory,editorConfig:this._editorConfig.markdown,updateEditorOnShow:!1});i.inputHidden=!1,i.rendered=!0,A.removeElements(i.node,"jp-Collapser"),A.removeElements(i.node,"jp-InputPrompt"),t=i;break}default:{const i=new x.RawCell({model:e,contentFactory:this.contentFactory,editorConfig:this._editorConfig.raw,updateEditorOnShow:!1});i.inputHidden=!1,A.removeElements(i.node,"jp-Collapser"),A.removeElements(i.node,"jp-InputPrompt"),t=i;break}}const i=document.createElement("div");return i.className="trash-can",H.element({container:i,height:"16px",width:"16px"}),i.onclick=()=>{const t=e.metadata.get("extensions");t.jupyter_dashboards.views[D].hidden=!0,e.metadata.set("extensions",t),this._context.model.dirty=!0,this._cellRemoved.emit(e.id)},new G(e.id,t,i)}execute(e){if("code"!==e.type)return;const t=new x.CodeCell({model:e,rendermime:this.rendermime,contentFactory:this.contentFactory,editorConfig:this._editorConfig.code,updateEditorOnShow:!0});j.SimplifiedOutputArea.execute(e.value.text,t.outputArea,this._context.sessionContext).catch((e=>console.error(e)))}_updateCells(){this._checkCellsMetadata(),this._contentChanged.emit(null)}_checkMetadata(){var e;let t=this._context.model.metadata.get("extensions");var i;t?t.jupyter_dashboards?(i=t.jupyter_dashboards.views[D])&&"name"in i&&"type"in i&&"maxColumns"in i&&"cellMargin"in i&&"defaultCellHeight"in i?this._info=null===(e=t.jupyter_dashboards)||void 0===e?void 0:e.views[D]:t.jupyter_dashboards.views[D]=this._info:t.jupyter_dashboards={version:1,activeView:D,views:{grid_default:this._info}}:t={jupyter_dashboards:{version:1,activeView:D,views:{grid_default:this._info}}},this._context.model.metadata.set("extensions",t)}_checkCellsMetadata(){var e;for(let t=0;t<(null===(e=this._context.model.cells)||void 0===e?void 0:e.length);t++){const e=this._context.model.cells.get(t);this._checkCellMetadata(e)}}_checkCellMetadata(e){let t=e.metadata.get("extensions");var i;t?t.jupyter_dashboards?(i=t.jupyter_dashboards.views[D])&&"hidden"in i&&"row"in i&&"col"in i&&"width"in i&&"height"in i||(t.jupyter_dashboards.views[D]={hidden:!0,row:null,col:null,width:2,height:2},e.metadata.set("extensions",t)):(t.jupyter_dashboards={activeView:D,views:{grid_default:{hidden:!0,row:null,col:null,width:2,height:2}}},e.metadata.set("extensions",t)):(t={jupyter_dashboards:{activeView:D,views:{grid_default:{hidden:!0,row:null,col:null,width:2,height:2}}}},e.metadata.set("extensions",t))}}var A;!function(e){e.removeElements=function(e,t){const i=e.getElementsByClassName(t);for(let e=0;e<i.length;e++)i[e].remove()}}(A||(A={}));class T extends b.Panel{constructor(e){super(),this.addClass("grid-panel"),this._context=e.context,this.rendermime=e.rendermime,this.contentFactory=e.contentFactory,this.mimeTypeService=e.mimeTypeService,this._editorConfig=e.editorConfig,this._notebookConfig=e.notebookConfig;const t=new R({context:this._context,rendermime:this.rendermime,contentFactory:this.contentFactory,mimeTypeService:this.mimeTypeService,editorConfig:this._editorConfig,notebookConfig:this._notebookConfig});this._gridstackWidget=new S(t),this.addWidget(this._gridstackWidget)}dispose(){this._gridstackWidget=void 0,k.Signal.clearData(this),super.dispose()}get editorConfig(){return this._editorConfig}set editorConfig(e){this._editorConfig=e}get notebookConfig(){return this._notebookConfig}set notebookConfig(e){this._notebookConfig=e}get gridWidgets(){var e,t;return null!==(t=null===(e=this._gridstackWidget)||void 0===e?void 0:e.gridWidgets)&&void 0!==t?t:[]}onUpdateRequest(e){var t;null===(t=this._gridstackWidget)||void 0===t||t.update()}compact(){var e;null===(e=this._gridstackWidget)||void 0===e||e.compact()}info(){var e;null===(e=this._gridstackWidget)||void 0===e||e.infoEditor()}revert(){this._context.model.dirty?(0,r.showDialog)({title:"Reload Notebook from Disk",body:"Are you sure you want to reload the Notebook from the disk?",buttons:[r.Dialog.cancelButton(),r.Dialog.warnButton({label:"Reload"})]}).then((e=>{e.button.accept&&!this._context.isDisposed&&this._context.revert()})):this._context.isDisposed||this._context.revert()}save(){this._context.save()}}class B extends a.ABCWidgetFactory{constructor(e){super(e),this.rendermime=e.rendermime,this.contentFactory=e.contentFactory||n.NotebookPanel.defaultContentFactory,this.mimeTypeService=e.mimeTypeService,this._editorConfig=e.editorConfig||n.StaticNotebook.defaultEditorConfig,this._notebookConfig=e.notebookConfig||n.StaticNotebook.defaultNotebookConfig}get editorConfig(){return this._editorConfig}set editorConfig(e){this._editorConfig=e}get notebookConfig(){return this._notebookConfig}set notebookConfig(e){this._notebookConfig=e}createNewWidget(e,t){const i={context:e,rendermime:t?t.content.rendermime:this.rendermime.clone({resolver:e.urlResolver}),contentFactory:this.contentFactory,mimeTypeService:this.mimeTypeService,editorConfig:t?t.content.editorConfig:this._editorConfig,notebookConfig:t?t.content.notebookConfig:this._notebookConfig};return new C(e,new T(i))}}class F{constructor(e){this._commands=e}createNew(e){const t=new r.ToolbarButton({tooltip:"Open with VoilÃ  GridStack editor",icon:m,onClick:()=>{this._commands.execute("docmanager:open",{path:e.context.path,factory:"Voila GridStack",options:{mode:"split-right",ref:e.id}}).then((t=>{t instanceof b.Widget&&e.content.disposed.connect((()=>{t.dispose()}))}))}});return e.toolbar.insertAfter("voila","jupyterlab-gridstack",t),t}}class L{createNew(e){const t=new r.ToolbarButton({tooltip:"Open with VoilÃ  Gridstack in a New Browser Tab",icon:h.launcherIcon,onClick:()=>{const t=f.PageConfig.getBaseUrl(),i=window.open(`${t}voila/render/${e.context.path}?voila-template=gridstack`,"_blank");null==i||i.focus()}});return e.toolbar.insertAfter("cellType","voila",t),t}}const P={id:"@voila-dashboards/jupyterlab-gridstack:editor",autoStart:!0,provides:w,requires:[n.NotebookPanel.IContentFactory,d.IEditorServices,s.IRenderMimeRegistry],optional:[o.ILayoutRestorer],activate:(e,t,i,o,s)=>{const d=new r.WidgetTracker({namespace:"jupyterlab-gridstack"});s&&s.restore(d,{command:"docmanager:open",args:e=>({path:e.context.path,factory:"Voila GridStack"}),name:e=>e.context.path,when:e.serviceManager.ready});const a=new B({name:"Voila GridStack",fileTypes:["notebook"],modelName:"notebook",preferKernel:!0,canStartKernel:!0,rendermime:o,contentFactory:t,editorConfig:n.StaticNotebook.defaultEditorConfig,notebookConfig:n.StaticNotebook.defaultNotebookConfig,mimeTypeService:i.mimeTypeService});return a.widgetCreated.connect(((t,i)=>{i.context.pathChanged.connect((()=>{d.save(i)})),d.add(i),i.update(),e.commands.notifyCommandChanged()})),e.docRegistry.addWidgetFactory(a),e.docRegistry.addWidgetExtension("Notebook",new L),e.docRegistry.addWidgetExtension("Notebook",new F(e.commands)),d}};var z=i(728),O=i(292);function*V(e){for(const t of e.gridWidgets)t instanceof O.WidgetRenderer&&(yield t)}const $={id:"@voila-dashboards/jupyterlab-gridstack:widgets",autoStart:!0,optional:[w,z.IJupyterWidgetRegistry],activate:(e,t,i)=>{i&&(null==t||t.forEach((e=>{(0,O.registerWidgetManager)(e.context,e.content.rendermime,V(e.content))})),null==t||t.widgetAdded.connect(((e,t)=>{(0,O.registerWidgetManager)(t.context,t.content.rendermime,V(t.content))})),console.log($.id,"activated"))}},q=[P,$]}}]);