"use strict";(self.webpackChunk_voila_dashboards_jupyterlab_preview=self.webpackChunk_voila_dashboards_jupyterlab_preview||[]).push([[925],{925:(e,t,n)=>{n.r(t),n.d(t,{CommandIDs:()=>b,default:()=>k});var a=n(89),o=n(770),r=n(466),i=n(595),l=n(792),s=n(849),d=n(875),c=n(49),v=n(797),u=n(168),h=n(271);const p=new c.LabIcon({name:"@voila-dashboards/jupyterlab-preview:voila",svgstr:'<svg width="330" height="330" data-name="Calque 1" version="1.1" viewBox="0 0 330 330" xmlns="http://www.w3.org/2000/svg">\n <defs>\n  <style>.cls-1{fill:#5dbcaf;}.cls-2{fill:#268380;}.cls-3{fill:#f8e14b;}</style>\n </defs>\n <title>Voila</title>\n <g class="jp-icon3">\n  <path class="cls-2" d="m165 320c-85.47 0-155-69.53-155-155s69.53-155 155-155 155 69.53 155 155-69.53 155-155 155zm0-275.49a120.49 120.49 0 1 0 120.49 120.49 120.62 120.62 0 0 0-120.49-120.49z" fill="#616161"/>\n  <path class="cls-3" d="m165 320c-85.47 0-155-69.53-155-155a17.26 17.26 0 1 1 34.51 0 120.62 120.62 0 0 0 120.49 120.49 17.26 17.26 0 1 1 0 34.51z" fill="#f8e14b"/>\n</g>\n</svg>\n'}),g=new v.Token("@voila-dashboards/jupyterlab-preview:IVoilaPreviewTracker");class m extends d.DocumentWidget{constructor(e){super(Object.assign(Object.assign({},e),{content:new o.IFrame({sandbox:["allow-same-origin","allow-scripts","allow-downloads","allow-modals","allow-popups"]})})),window.onmessage=e=>{var t,n,a,o,r;switch(null===(t=e.data)||void 0===t?void 0:t.level){case"debug":console.debug(...null===(n=e.data)||void 0===n?void 0:n.msg);break;case"info":console.info(...null===(a=e.data)||void 0===a?void 0:a.msg);break;case"warn":console.warn(...null===(o=e.data)||void 0===o?void 0:o.msg);break;case"error":console.error(...null===(r=e.data)||void 0===r?void 0:r.msg);break;default:console.log(e)}};const{getVoilaUrl:t,context:n,renderOnSave:a}=e;this.content.url=t(n.path),this.content.title.icon=p,this._renderOnSave=null!=a&&a,n.pathChanged.connect((()=>{this.content.url=t(n.path)}));const r=new o.ToolbarButton({icon:c.refreshIcon,tooltip:"Reload Preview",onClick:()=>{this.reload()}}),i=o.ReactWidget.create(h.createElement("label",{className:"jp-VoilaPreview-renderOnSave"},h.createElement("input",{style:{verticalAlign:"middle"},name:"renderOnSave",type:"checkbox",defaultChecked:a,onChange:e=>{this._renderOnSave=e.target.checked}}),"Render on Save"));this.toolbar.addItem("reload",r),n&&(this.toolbar.addItem("renderOnSave",i),n.ready.then((()=>{n.fileChanged.connect((()=>{this.renderOnSave&&this.reload()}))})))}dispose(){this.isDisposed||(super.dispose(),u.Signal.clearData(this))}reload(){const e=this.content.node.querySelector("iframe");e.contentWindow&&e.contentWindow.location.reload()}get renderOnSave(){return this._renderOnSave}set renderOnSave(e){this._renderOnSave=e}}class w extends d.ABCWidgetFactory{constructor(e,t){super(t),this.getVoilaUrl=e,this.defaultRenderOnSave=!1}createNewWidget(e){return new m({context:e,getVoilaUrl:this.getVoilaUrl,renderOnSave:this.defaultRenderOnSave})}}var b;!function(e){e.voilaRender="notebook:render-with-voila",e.voilaOpen="notebook:open-with-voila"}(b||(b={}));class f{constructor(e){this._commands=e}createNew(e){const t=new o.ToolbarButton({className:"voilaRender",tooltip:"Render with Voilà",icon:p,onClick:()=>{this._commands.execute(b.voilaRender)}});return e.toolbar.insertAfter("cellType","voilaRender",t),t}}const y={id:"@voila-dashboards/jupyterlab-preview:plugin",autoStart:!0,optional:[s.INotebookTracker,o.ICommandPalette,a.ILayoutRestorer,l.IMainMenu,r.ISettingRegistry],provides:g,activate:(e,t,n,a,r,l)=>{const s=new o.WidgetTracker({namespace:"voila-preview"});function d(n){var a;const o=null!==(a=null==t?void 0:t.currentWidget)&&void 0!==a?a:null;return!1!==n.activate&&o&&e.shell.activateById(o.id),o}function c(){return null!==(null==t?void 0:t.currentWidget)&&(null==t?void 0:t.currentWidget)===e.shell.currentWidget}function v(e){return`${i.PageConfig.getBaseUrl()}voila/render/${e}`}a&&a.restore(s,{command:"docmanager:open",args:e=>({path:e.context.path,factory:u.name}),name:e=>e.context.path,when:e.serviceManager.ready});const u=new w(v,{name:"Voila-preview",fileTypes:["notebook"],modelName:"notebook"});u.widgetCreated.connect(((e,t)=>{t.context.pathChanged.connect((()=>{s.save(t)})),s.add(t)}));const h=e=>{u.defaultRenderOnSave=e.get("renderOnSave").composite};l&&Promise.all([l.load(y.id),e.restored]).then((([e])=>{h(e),e.changed.connect(h)})).catch((e=>{console.error(e.message)})),e.docRegistry.addWidgetFactory(u);const{commands:p,docRegistry:g}=e;if(p.addCommand(b.voilaRender,{label:"Render Notebook with Voilà",execute:async e=>{const t=d(e);let n;t&&(n=t.context,await n.save(),p.execute("docmanager:open",{path:n.path,factory:"Voila-preview",options:{mode:"split-right"}}))},isEnabled:c}),p.addCommand(b.voilaOpen,{label:"Open with Voilà in New Browser Tab",execute:async e=>{const t=d(e);if(!t)return;await t.context.save();const n=v(t.context.path);window.open(n)},isEnabled:c}),n){const e="Notebook Operations";[b.voilaRender,b.voilaOpen].forEach((t=>{n.addItem({command:t,category:e})}))}r&&r.viewMenu.addGroup([{command:b.voilaRender},{command:b.voilaOpen}],1e3);const m=new f(p);return g.addWidgetExtension("Notebook",m),s}},k=y}}]);